
*. Constraint
	타겟 보드와 같은 네트워크 상에 연결되어 있지 않을 시,
	타겟 보드에 접속불가 에러 발생

0. Preparation

- host machine : 
	
- board :
	- grep . /etc/issue*
	PRETTY_NAME="Debian GNU/Linux 9 (stretch)"
	NAME="Debian GNU/Linux"
	VERSION_ID="9"
	VERSION="9 (stretch)"
	ID=debian
	HOME_URL="https://www.debian.org/"
	SUPPORT_URL="https://www.debian.org/support"
	BUG_REPORT_URL="https://bugs.debian.org/"	

	- uname -r
	4.9.0-rc8-rt1+

	- sudo iwconfig
	enp1s0    no wireless extensions.

	enp2s0    no wireless extensions.

	wlp4s0    IEEE 802.11  ESSID:off/any
          	Mode:Managed  Access Point: Not-Associated   Tx-Power=0 dBm
          	Retry short limit:7   RTS thr:off   Fragment thr:off
          	Encryption key:off
          	Power Management:off

	lo        no wireless extensions.

	enp3s0    no wireless extensions.

정리>

1. 현재 보드 안에 커널 2가지 종류가 존재한다.
2. 원래 버전 , 추가된 버전
3. 원래 버전(board default version) : 보드의 아키텍처에 맞는 기본 설정 파일
	-> 이 기본 설정 파일을 호스트 머신으로 가지고 와야함
	-> scp 명령어를 이용하여 전송
4. 추가된 버전 : 802.11p 패치와 real-time kernel 모드가 적용된 설정 파일
	-> 손 댈 필요 없음

5. 만들어야 할 세번 째 커널 : board default 에 802.11p 패치가 적용된 설정 파일

=================================================================================

* STEPS TO GET KERNEL IMAGE FOR THE BOARD*

1. clone linux source
- git clone https://github.com/torvalds/linux

2. roll back Linux version to 4.9 
- git checkout v4.9-rc8

3. copy the one for backups
- cp linux linux_cpy

4. extract configuration file(config...-amd64) from the hardware.
 :running on the host machine.
- scp user@IPaddress:/boot/config...-amd64 /home/user/linux/.config

5. copy 80211p_v4.9.patch to linux folder
- mv 80211p_v4.9.patch /home/user/linux

6. patch the file to linux folder
- cat 80211p_4.9.patch | patch -p1
 :there should be no error

7. make configuration file
- make menuconfig

 *curses.h error solution : sudo apt-get install libncurses5-dev libcursesw5-dev

 : two features are revised
 & in network support, select mac option and check OCB
 & in kernel hacking, uncheck bug reporting
 & save and exit

8. check out the number of cores in the machine by 'htop'
- -j(nb.cores * 2) 
- make -j16

 => Once you have followed all steps above, 
     you would get a new kernel image, selected modules and firmwares.
=================================================================================

* STEPS TO TRANSFER NEW KERNEL FILES TO THE BOARD *

1. Create a new folder called "compiled" to save compiled kernel into it. //컴파일된 커널을 설치할 새로운 경로 폴더를 만든다.
- (on the host machine)
- ~/Kernel $ mkdir compiled

2. Change the route where it is supposed to be installed in the "compiled" folder. //설치할 경로를 새로 만든 compiled 폴더로 변경해준다.
- (default INSTALL_PATH is /boot) //기본 INSTALL_PATH는 /boot 로 설정되어있다.

- we need to create another folder for boot files under "compiled" folder. //compiled 폴더 밑에 boot 폴더를 따로 만들어 주어야 한다.
- ~/Kernel/compiled $ mkdir boot
- ~/Kernel/compiled $ export INSTALL_PATH=/home/user/Kernel/compiled/boot

3. Compile the kernel files to the "compiled" folder. //compiled 폴더에 커널을 설치한다.
- ~/Kernel/linux $ make install

 Result(~/Kernel/compiled/boot)
- System.map-4.9.0-rc8
- config-4.9.0-rc8+
- vmlinuz-4.9.0-rc8+

4. Change the route where modules are supposed to be installed in the "compiled" folder. //모듈이 설치될 경로를 compiled 폴더로 변경해준다.
~/Kernel/compiled $ export INSTALL_MOD_PATH=/home/user/Kernel/compiled

5. Add a parameter which is INSTALL_MOD_STRIP so that we don't get any of debug files, then compile them.  // 값을 변경하여 디버그 내용을 제외한 모듈을 compiled 폴더에 설치한다.
~/Kernel/linux $ make INSTALL_MOD_STRIP=1 modules_install

6. Compress all files under boot and lib folders. //설치된 boot, lib 폴더를 압축한다.
~/Kernel/compiled $ tar czf kernel.tgz *

7. Copy the compressed file to /tmp on the board. //압축된 kernel.tgz 파일을 보드의 /tmp 폴더에 옮긴다.
~/Kernel/compiled $ scp kernel.tgz user@10.4.89.241:/tmp

8. Unzip kernel.tgz  //연결된 보드에서 압축된 kernel.tgz 파일을 풀어준다.
- (on the board)
- /tmp $ tar -xvf kernel.tgz

9. Copy the files (/tmp/boot) to (/boot). //tmp 폴더에 있는 압축해제된 boot폴더를 기존 루트에 있는 boot폴더로 옮겨준다.
- /tmp $cp -fr boot /

10. Copy the files (/tmp/lib) to (/lib). //tmp 폴더에 있는 압축해제된 lib폴더도 동일한 과정을 거쳐 옮긴다
- /tmp $cp -fr lib /


11. Update // 업데이트를 통해 새로 설치한 커널을 실행 시킬 수 있도록 한다.
- 명령어를 /boot 에서 실행해야 할 지, /lib 에서 실행해야 할 지 모름

=================================================================================